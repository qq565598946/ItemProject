"use strict";var laypage=layui.laypage,form=layui.form,projectName=null;function GetQueryString(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(e);return null!=a?unescape(a[2]):null}var accessToken=sessionStorage.getItem("access_token"),xhsdk=new Xhsdk(appID,appSecretKey);function init(t,s){var e={accessToken:accessToken,query:{projectName_LIKE:""},page:{current:t,size:s}};$(".loading-box1").show(),xhsdk.ajax({type:"post",url:solution+"/projectinfo/list",contentType:"application/json",dataType:"json",data:JSON.stringify(e),beforeSend:function(){$(".loading-box1").show()},success:function(t){if(405==t.errorCode)return layer.msg("请重新登录!"),void $(".loading-box1").hide();if(200==t.code){var e=t.data.records,a=t.data.total,n=t.data.current;a<=10?$("#page-button").hide():$("#page-button").show(),renderData(e),$(".loading-box1").hide(),laypage.render({elem:"page-button",count:Math.ceil(a),limit:s,groups:a,layout:["prev","page","next"],curr:n,jump:function(t,e){e||init(t.curr,s)}})}else layer.msg(t.data),$(".loading-box1").hide()},complete:function(){$(".loading-box1").hide()},error:function(t){layer.msg("请求出现错误!!"),$(".loading-box1").hide()}})}function renderData(t){if($(".itemCon").empty(),null==t)return layer.msg("暂无数据"),!1;for(var e=0;e<t.length;e++){var a=t[e].auditStatus,n="",s="";switch(0==a||3==a?s='<a onclick="editproject(this)" title="编辑" data-id="'+t[e].id+'" data-status="'+t[e].auditStatus+'" data-name="'+t[e].projectName+'"><i class="iconfont icon-bianji"></i></a><a href="#"  title="查看" data-id="'+t[e].id+'" data-status="'+t[e].auditStatus+'" onclick="Itemdetails(this)" class="destail-button"><i class="iconfont icon-chakan"></i></a>':2!=a&&1!=a||(s='<a href="#" title="查看" data-id="'+t[e].id+'" data-status="'+t[e].auditStatus+'" onclick="Itemdetails(this)" class="destail-button"><i class="iconfont icon-chakan"></i></a>'),a){case 0:n="草稿";break;case 1:n='<span style="color: #cc940b;">审核中</span>';break;case 2:n='<span style="color:#15ca15">通过</span>';break;case 3:n='<span style="color:#CCCCCC">驳回</span>';break;case 4:n="下线";break;case 5:n="删除";break;default:n="-"}var o="<tr><td>"+t[e].projectCode+"</td><td>"+t[e].projectName+"</td><td>1.0</td><td>"+t[e].buildUnitName+"</td><td>"+t[e].buildUnitLeaderName+'</td><td  class="status-btn" data-status="'+t[e].auditStatus+'"><i></i><span>'+n+'</span></td><td><div class="show-box">'+s+"</div></td></tr>";$(o).appendTo(".itemCon")}}function Itemdetails(t){var e=$(t).data("id"),a=$(t).data("status");projectName=$(t).parent().find("td").eq(3).text(),layer.open({type:2,title:"项目详情",shadeClose:!0,area:["100%","100%"],content:"./page/projectProgramme/projectProgramme.html?deatailId="+e+"&status="+a+"&TokenCode="+accessToken,success:function(t,e){layer.getChildFrame("body",e)}})}function editproject(t){var e=$(t).data("id"),a=$(t).data("status");projectName=$(t).data("name"),layer.open({type:2,title:"修改项目",shadeClose:!0,area:["100%","100%"],content:"./page/projectApply/projectApply.html?deatailId="+e+"&tag=2&status="+a+"&TokenCode="+accessToken})}function search_result(t){var e=$(t).data("status");layer.open({type:2,title:"项目进度",shadeClose:!0,area:["100%","100%"],content:"./page/pLogisticsTracking/pLogisticsTracking.html?status="+e+"&TokenCode="+accessToken})}function add0(t){return t<10?"0"+t:t}function formatTime(t){var e=new Date(t),a=e.getFullYear(),n=e.getMonth()+1,s=e.getDate(),o=e.getHours(),i=e.getMinutes(),d=e.getSeconds();return a+"-"+add0(n)+"-"+add0(s)+" "+add0(o)+":"+add0(i)+":"+add0(d)}xhsdk.setGetaWayUrl(GetaWay_url),xhsdk.setToken(accessToken),xhsdk.setReqType("app"),xhsdk.setUserInfo(null),init(1,10),$("#add-item").click(function(){layer.open({anim:5,maxmin:!0,type:2,skin:"layui-layer-molv",title:"添加项目",shadeClose:!0,area:["100%","100%"],content:"./page/projectApply/projectApply.html?tag=1&TokenCode="+accessToken})});