"use strict";var form=layui.form;function GetQueryString(t){var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(i);return null!=a?unescape(a[2]):null}var accessToken=GetQueryString("TokenCode"),xhsdk=new Xhsdk(appID,appSecretKey);xhsdk.setGetaWayUrl(GetaWay_url),xhsdk.setToken(accessToken),xhsdk.setReqType("app"),xhsdk.setUserInfo(null);var deatailId=GetQueryString("deatailId"),status=GetQueryString("status"),loadingtip=$(".loading-box");if(0==status||3==status);else if(2==status);else{var auditHTML='<div class="box-audit"> <button class="layui-btn layui-btn-danger layui-btn-sm" style="width:100px" id="disagree" onclick="edit()">审核</button></div>';$(".box-audit").html(auditHTML)}function Projectapply(t){layer.confirm("项目申请",{title:"申请",btn:["确认","取消"]},function(){var t={id:deatailId,applyBy:$("#applyName").val()};xhsdk.ajax({type:"post",url:solution+"/projectinfo/apply",contentType:"application/json",dataType:"json",data:JSON.stringify(t),success:function(t){200==t.code?layer.msg("申请完成!",{icon:1,time:600},function(){parent.location.reload()}):layer.msg("请求出现错误!!")},error:function(t){layer.msg("请求出现错误!!")}})},function(){layer.msg("已取消")})}function detailsData(){var t={query:{id:deatailId,projectName_LIKE:parent.projectName}};loadingtip.show(),xhsdk.ajax({type:"post",url:solution+"/projectinfo/find",contentType:"application/json",dataType:"json",data:JSON.stringify(t),success:function(t){200==t.code?(initdata(t.data),loadingtip.hide()):(loadingtip.hide(),layer.msg("请求出现错误!!"))},error:function(t){loadingtip.hide(),layer.msg("请求出现错误!!")}})}function initdata(t){var i=t;$(".projectName").text(i.projectName),$(".projectBackground").text(i.projectDesc),$(".download-file").attr("href",i.projectFile),$(".projectResponsible").text(i.buildUnitLeaderName),$(".projectCode").text(i.projectCode),$(".buildUnitName").text(i.buildUnitName)}function isagredd(i){var a=null,t=null;t=2==i?(a=2,"同意"):(a=3,"不同意"),layer.confirm(t,{title:"审核",btn:["确认","取消"]},function(){var t={id:deatailId,auditStatus:a,auditBy:$("#applyName").val()};loadingtip.show(),xhsdk.ajax({url:solution+"/projectinfo/audit",type:"POST",contentType:"application/json",data:JSON.stringify(t),success:function(t){200==t.code&&(loadingtip.hide(),2==i?layer.msg("审核通过"):layer.msg("审核不通过"),setTimeout(function(){parent.location.reload()},500))},error:function(t){loadingtip.hide()}})},function(){layer.msg("已取消")})}$(function(){detailsData()}),$(".ProgrammeList").on("click","li",function(){var t=$(this).index();$(this).addClass("layui-this").siblings().removeClass("layui-this"),$(".layui-col-md10 .table-box ").eq(t).css("display","block").siblings().css("display","none")}),$(".btn-group").on("click",".cancelEditor",function(){$(".popUpbox").hide()});var opinion=null;function edit(t){$(".popUpbox").show()}form.on("radio(staffCheckbox)",function(t){return opinion=t.value,!1}),$(".btn-group").on("click",".getDocData",function(){var t=$("#opinion").val().length;if(null!=opinion)if(3==opinion&&t<1)layer.msg("请输入审核意见");else{var i={accessToken:accessToken,id:deatailId,auditStatus:opinion,opinion:$("#opinion").val(),auditBy:$("#applyName").val()};loadingtip.show(),xhsdk.ajax({url:solution+"/projectinfo/audit",type:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(t){200==t.code?(loadingtip.hide(),layer.msg("审核成功"),setTimeout(function(){parent.location.reload()},500)):(layer.msg(t.data),loadingtip.hide())},error:function(t){loadingtip.hide()}}),$(".popUpbox").hide()}else layer.msg("请选择审核意见！")});