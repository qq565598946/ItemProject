"use strict";var laypage=layui.laypage,pageButton=null,Commonurl=null,project={},typedata=null;function GetQueryString(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(e);return null!=a?unescape(a[2]):null}var accessToken=sessionStorage.getItem("access_token"),loadingtip=$(".loading-box"),xhsdk=new Xhsdk(appID,appSecretKey);function init(t,n){switch(Commonurl=solution+"/xhWorkOrder/list",typedata){case 1:(project={query:{auditStatus:"1"}}).accessToken=accessToken,project.page={current:t,size:n};break;case 2:(project={query:{auditStatus:"2"}}).accessToken=accessToken,project.page={current:t,size:n};break;case 3:(project={query:{auditStatus:"3"}}).accessToken=accessToken,project.page={current:t,size:n};break;case 4:(project={query:{}}).accessToken=accessToken,project.page={current:t,size:n};break;default:(project={query:{}}).accessToken=accessToken,project.page={current:t,size:n}}loadingtip.show(),xhsdk.ajax({type:"post",url:Commonurl,contentType:"application/json",dataType:"json",data:JSON.stringify(project),success:function(t){if(405!=t.errorCode)if(200==t.code){var e=t.data.records,a=t.data.total,s=t.data.current;auditData(e),laypage.render({elem:"page-button2",count:Math.ceil(a),limit:n,groups:a,layout:["count","prev","page","next","skip"],curr:s,jump:function(t,e){e||init(t.curr,n)}})}else layer.msg("请求出现错误!!"),loadingtip.hide();else layer.msg("请重新登录！")},complete:function(){$(".loading-box").hide()},error:function(t){loadingtip.hide(),layer.msg("请求出现错误!!")}})}function auditData(t){$(".project-implem").empty(),$(".itemCon").empty();for(var e=0;e<t.length;e++){var a=t[e].auditStatus,s=t[e].type,n=(t[e].auditStage,""),o="";switch(n=1==s?"项目立项":"项目实施方案",a){case"0":o='<span style="color:#b5b5b5">已过期</span>';break;case"1":o='<span style="color: #ccb75f;">待审核</span>';break;case"2":o='<span style="color:#2dca33">已审核</span>';break;case"3":o='<span style="color:#CCCCCC">驳回</span>';break;case"4":o='<span style="color:#b5b5b5">下线</span>';break;case"5":o="删除";break;default:o="-"}var d="<tr><td>"+(e+1)+" </td><td>"+n+" </td><td>"+t[e].projectName+"</td><td>"+t[e].projectCode+"</td><td>"+t[e].version+"</td><td><i></i><span>"+o+"</span></td><td>"+t[e].applyName+"</td><td>"+t[e].auditName+"</td><td>"+t[e].applyTime+'</td><td data-solutionid="'+t[e].solutionId+'" data-status="'+t[e].auditStatus+'"   data-id="'+t[e].projectId+'" data-auditstatus="'+t[e].auditStage+'" data-applyBy="'+t[e].applyBy+'"  data-type="'+t[e].type+'"  data-applyname="'+t[e].applyName+'" onclick="itemaudit(this)" class="destail-button">详情</td></tr>';$(d).appendTo(".project-implem")}}function itemaudit(n){var t=$(n).data("type"),e=$(n).data("id"),a=$(n).data("solutionid"),s=$(n).data("status"),o=$(n).data("auditstatus"),d=$(n).data("applyname");1==t?layer.open({type:2,title:"项目立项审核",shadeClose:!0,area:["100%","100%"],content:"../projectProgramme_Audit/projectProgramme_Audit.html?deatailId="+e+"&status="+s+"&TokenCode="+accessToken,success:function(t,e){layer.getChildFrame("body",e).find("#applyName").val(d)}}):layer.open({type:2,title:"项目实施审核",shadeClose:!0,area:["100%","100%"],content:"../projectAudit_destail/projectAudit_destail.html?moduleid="+a+"&status="+s+"&projectID="+e+"&TokenCode="+accessToken+"&solutionstage="+o,success:function(t,e){var a=layer.getChildFrame("body",e),s=$(n).data("applyBy");a.find(".applyBy").val(s)}})}function add0(t){return t<10?"0"+t:t}function formatTime(t){var e=new Date(t),a=e.getFullYear(),s=e.getMonth()+1,n=e.getDate(),o=e.getHours(),d=e.getMinutes(),r=e.getSeconds();return a+"-"+add0(s)+"-"+add0(n)+" "+add0(o)+":"+add0(d)+":"+add0(r)}xhsdk.setGetaWayUrl(GetaWay_url),xhsdk.setToken(accessToken),xhsdk.setReqType("app"),xhsdk.setUserInfo(null),$("#audit_btn button").click(function(){var t=$(this).index();switch($("#audit_btn button ").eq(t).addClass("active").siblings().removeClass("active"),typedata=null,t){case 0:init(typedata=1,10);break;case 1:typedata=2,init(1,10);break;case 2:typedata=3,init(1,10);break;case 3:typedata=4,init(1,10)}}),$(function(){init(typedata=1,10)});