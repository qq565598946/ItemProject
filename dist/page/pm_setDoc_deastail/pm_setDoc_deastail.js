"use strict";var element=layui.element,layer=layui.layer,form=layui.form,formSelects=layui.formSelects;function GetQueryString(e){var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(i);return null!=n?unescape(n[2]):null}var itemID=GetQueryString("itemID"),accessToken=GetQueryString("TokenCode"),auditstatus=GetQueryString("auditstatus"),projectid=GetQueryString("projectid"),addprojectID=GetQueryString("addprojectID"),xhsdk=new Xhsdk(appID,appSecretKey);function initnormalize(){xhsdk.ajax({type:"post",url:solution+"/dictionary/find",contentType:"application/json",dataType:"json",data:JSON.stringify({name:"开发规范"}),success:function(e){if(200==e.code){$(".norm-content").text(e.data[3].content);var i='<option value="'+e.data[2].id+'">'+e.data[2].content+"</option>";$(i).appendTo("#service1");for(var n=0;n<=e.data.length;n++){if(2==n)return;var t='<option value="'+e.data[n].id+'">'+e.data[n].content+"</option>";$(t).appendTo("#service")}form.render()}else layer.msg(e.data)},error:function(e){layer.msg("请求出现错误!!")}})}function initdata(){var e={solutionId:itemID},m=layer.load(2,{shade:!1});xhsdk.ajax({type:"POST",url:solution+"/projectManagement/list",contentType:"application/json",dataType:"json",data:JSON.stringify(e),success:function(e){if(200==e.code){layer.close(m);var i=e.data.solutioninfoList,n=e.data.overviewList,t=e.data.demanalysisList,a=e.data.archidesignList,o=e.data.microserviceList,s=e.data.applicationdesignList,l=e.data.risksolutionList,d=e.data.overviewaAuditList,c=e.data.demanalysisAuditList,p=e.data.archidesignAuditList,r=e.data.microserviceAuditList,v=e.data.applicationdesignAuditList,u=e.data.risksolutionAuditList;solutionDetail(i),projectDetail(n,d),DetailDemanalysis(t,c),DetailArchidesign(a,p),Detailmicroservice(o,r),Detailapplicationdesign(s,v),Detaildeployrun(l,u)}else layer.close(m),layer.msg("请求出现错误!!")},error:function(e){layer.close(m),layer.msg("请求出现错误!!")}})}function auditContent(e,i,n){$(e).find(".show-audit-box ul").empty(),$(e).find(".show-audit-box").empty();for(var t=0;t<i.length;t++){var a='<div class="box-audit-content"><ul><li>审核意见: '+(t+1)+" : "+i[t].opinion+"</li></ul>\n                            <div>审核人 : <span>"+i[t].auditName+"</span></div>\n                            <div>审核时间 : <span>"+i[t].auditTime+"</span></div>\n                            </div>";$(e).find(".show-audit-box").append(a),$(e).find(".audit-box").show()}}function showAuditBox(){$(".audit-box").hover(function(){$(this).find(".show-audit-box").show(600)},function(){$(this).find(".show-audit-box").hide(300)})}function solutionDetail(e){if(!(e.length<1))for(var i=0;i<e.length;i++){$(".project_Name").val(e[i].solutionName),$(".makeUnit").val(e[i].makeUnit),$(".solutionVersion").val(e[i].solutionVersion),$(".staffvalue").val(e[i].developLeaderName),$(".kfdevelopOrgan").val(e[i].developOrgan),0<e[i].developerName.length&&($("#staffvalue_two").text(e[i].developerName),$("#pj-staffvalue .levelTips").hide(),$("#pj-staffvalue .addItem-box").hide())}}function projectDetail(e,i){for(var n=0;n<e.length;n++)$("#pj-background").children("p").text(e[n].projectBackground),$("#systemCurrent").children("p").text(e[n].systemCurrent),$("#buildGoal").children("p").text(e[n].buildGoal),$("#buildContent").children("p").text(e[n].buildContent);0<i.length&&auditContent("#pj-overview",i)}function DetailDemanalysis(e,i){for(var n=0;n<e.length;n++)$("#functionalRoleAnalysis").children("p").text(e[n].functionalRoleanalysis),$("#businessRequirements").children("p").text(e[n].businessRequirements),$("#dataIntegration").children("p").text(e[n].dataIntegration);0<i.length&&auditContent("#pj-demandAnalysis",i)}function DetailArchidesign(e,i){for(var n=0;n<e.length;n++)$("#frameworkdesign").children("p").text(e[n].frameworkDesign),$("#demo1").attr("src",e[n].topologicalPic),$("#principlesroutes").children("p").text(e[n].principlesRoutes);0<i.length&&auditContent("#pj-design",i)}function Detailmicroservice(e,i){0<i.length&&auditContent("#pj-service",i,5);for(var n=0;n<e.length;n++){var t=e[n].generalService.split(","),a=e[n].basicService.split(","),o=' <div class="pj-item-body service-list microserviceList'+n+'">\n                          <div class="secLevel">\n                                <div class="deploy">\n                                    <p class="editTitle">服务名字</p>\n                                    <div class="layui-input-inline" style="width: 500px;margin-left: 7px;">\n                                        <input type="tel" name="phone" lay-verify="" autocomplete="off" class="layui-input" id="serviceName" disabled value="'+e[n].serviceName+'">\n                                    </div>\n                                </div>\n                            </div>\n                    <div class="secLevel">\n                        <div class="pj-item-body-top layui-form">\n                            <div class="deploy">\n                                <p class="editTitle">服务类型</p>\n                                <div class="layui-input-inline option-left">\n                                    <select name="quiz" id="service-option" disabled class="serviceType'+n+'">\n                                        <option value="1">基础技术服务</option>\n                                        <option value="2">通用业务服务设计</option>\n                                        <option value="3">应用服务设计</option>\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="secLevel">\n                        <div class="pj-item-body-top">\n                            <p class="editTitle">服务设计</p>\n                        </div>\n                        <div class="pj-item-body-bottom" id="serviceDesign">\n                                <p>'+e[n].serviceDesign+'</p>\n                        </div>\n                    </div>\n                    <div class="secLevel">\n                        <div class="pj-item-body-top">\n                            <p class="editTitle">依赖的服务</p>\n                            <div class="editOprate">\n                                <div class="editCon">\n                                    \x3c!--<i class="iconfont icon-bianji"></i>--\x3e\n                                    \x3c!--<span>编辑</span>--\x3e\n                                </div>\n                            </div>\n                        </div>\n                        <div class="pj-item-body">\n                            <div class="common">通用业务服务(多选)</div>\n                            <div class="box-select-business layui-input-inline" style="margin:20px 0px; width: 100%">\n                                <select xm-select="business_des'+n+'" disabled>\n                                              \n                                            \n                                              \n                                </select>\n                            </div>\n                          \n                            <div class="common">基础技术服务(多选)</div>\n                             <div class="box-select-technical layui-input-inline" style="margin:20px 0px;width: 100%">\n                                <select xm-select="technical_des'+n+'" disabled>\n                                         \n                                </select>\n                            </div>\n                           \n                        </div>\n                    </div>\n                      \x3c!--部署环境和运行资源--\x3e\n                <div class="secLevel">\n                    <div class="pj-item-body-top">\n                        <p class="editTitle">部署环境和运行资源</p>\n                    </div>\n                    <div class="deploy-edit">\n                        <div class="deploy-box-tip1">\n                            <div class="deploy">\n                                <p class="common">部署环境 :</p>\n                                <div class="option-box">\n                                  <p>'+e[n].deploymentEnvironment+'</p>\n                                    \x3c!--<select name="quiz" id="service" class="deploymentEnvironment">--\x3e\n                                        \x3c!--<option value="请选择"></option>--\x3e\n                                    \x3c!--</select>--\x3e\n                                </div>\n                            </div>\n                            <div class="deploy">\n                                <p class="common">运行资源 :</p>\n                                <div class="option-box">\n                                <p>'+e[n].runResource+'</p>\n                                    \x3c!--<select name="quiz" id="service1" class="runResource">--\x3e\n                                        \x3c!--<option value="请选择"></option>--\x3e\n                                    \x3c!--</select>--\x3e\n                                </div>\n                            </div>\n            \n                        </div>\n                    </div>\n                </div>\n                </div>';$(o).appendTo("#service-box"),$(".serviceType"+n+" option[value = "+e[n].serviceType+"]").attr("selected","selected"),form.render(),GetserviceData("business_des"+n,"technical_des"+n,a,t,3)}}function GetserviceData(t,a,o,s,l){var d=[];xhsdk.ajax({url:solution+"/microservice/getServerList",type:"POST",contentType:"application/json",dataType:"json",data:'{"accessToken":"'+accessToken+'"}',success:function(e){if(200==e.code){$(".allRelySerItem").html("");for(var i=e.data.resulList,n=0;n<i.length;n++)d.push({name:i[n].serverName,value:i[n].serverinfoID});if(formSelects.data(t,"local",{arr:d}),formSelects.data(a,"local",{arr:d}),1==l)return;formSelects.value(t,o,!0),formSelects.value(a,s,!0)}else layer.msg("网络错误！")},error:function(e){layer.msg("数据请求错误!")}})}function Detailapplicationdesign(e,i){var n=null;0<i.length&&auditContent("#pj-application",i,5);for(var t=0;t<e.length;t++){n=e[t].frontIntegration.split(",");var a='  <div class="pj-item-body service-list appliction-list'+t+'">\n                     <div class="secLevel">\n                      <div class="pj-item-body-top" style="position: relative">\n                <p class="editTitle">应用名称</p>\n                <div class="name-app">'+e[t].applicationName+'</div>\n            </div>\n                                    \x3c!--<div class="deploy">--\x3e\n                                      \x3c!--<p class="editTitle">应用名称</p>--\x3e\n                                        \x3c!----\x3e\n                                            \x3c!----\x3e\n                                    \x3c!--</div>--\x3e\n        <div class="secLevel">\n            <div class="pj-item-body-top">\n                <p class="editTitle">应用概述</p>\n            </div>\n            <div class="pj-item-body-bottom" id="applicationOverview">\n              <p>'+e[t].applicationOverview+'</p>\n            </div>\n        </div>\n        <div class="secLevel">\n            <div class="pj-item-body-top">\n                <p class="editTitle">应用UI/UE规划</p>\n            </div>\n            <div class="pj-item-body-bottom" id="applicationPlanning">\n             <p>'+e[t].applicationPlanning+'</p>\n            </div>\n        </div>\n        <div class="secLevel">\n            <div class="pj-item-body-top">\n                <p class="editTitle">应用功能逻辑</p>\n            </div>\n            <div class="pj-item-body-bottom" id="applyLogicdiagram">\n               <p>'+e[t].applyLogicdiagram+'</p>\n            </div>\n        </div>\n        <div class="secLevel">\n            <div class="pj-item-body-top" style="margin-top:30px;">\n                <div class="deploy" style="width: 100%">\n                    <p class="editTitle">前端服务化能力集成</p>\n            \n                   \n                         <div class="" style="margin: 14px 0px 5px 0px;">\n\n                                            <select xm-select="select-id'+t+'" disabled="disabled">\n                                                <option value="1">人脸识别服务</option>\n                                                <option value="2">车牌识别服务</option>\n                                                <option value="3">证件识别服务</option>\n                                                <option value="4">扫一扫服务</option>\n                                                <option value="5">证件识别服务</option>\n                                                <option value="6">选择文件</option>\n                                                <option value="7">电子签名</option>\n                                                <option value="8">获取定位</option>\n                                                <option value="9">获取手机状态（NFC、蓝牙、GPS、WIFI等）</option>\n                                                <option value="10">设置手机状态（NFC、蓝牙、GPS、WIFI等）</option>\n                                                <option value="11">获取海拔</option>\n                                                <option value="12">图片压缩</option>\n                                            </select>\n                                        </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>';$(a).appendTo(".application-box"),formSelects.render("select-id"+t),formSelects.value("select-id"+t,n,!0)}}function Detaildeployrun(e,i){0<i.length&&auditContent("#pj-solution",i);for(var n=0;n<e.length;n++)$("#riskSolution").children("p").text(e[n].riskSolution)}function returnTop(){$(window).scroll(function(){100<$(window).scrollTop()?$(".returnTop").fadeIn(1e3):$(".returnTop").fadeOut(1e3)}),$(".returnTop").click(function(){return $("html").scrollTop()?$("html").animate({scrollTop:0},500):$("body").animate({scrollTop:0},500),!1})}function projectchange(){layer.confirm("确认变更吗？",{btn:["确认","取消"]},function(){window.open("../pm_setDoc/pm_Change/project_Change.html?tag=1&itemID="+itemID+"&TokenCode="+accessToken+"&auditstatus="+auditstatus+"&flagid=2&projectid="+projectid+"&addprojectID="+addprojectID)},function(){layer.msg("已取消")})}xhsdk.setGetaWayUrl(GetaWay_url),xhsdk.setToken(accessToken),xhsdk.setReqType("app"),xhsdk.setUserInfo(null),$(function(){if(1==auditstatus||0==auditstatus){var e='<button class="layui-btn layui-btn-normal layui-btn-sm" onclick="projectchange(this)">变更申请</button>';$(".save-btn").html(e)}else if(2==auditstatus){e='<button class="layui-btn layui-btn-normal layui-btn-sm" onclick="projectchange(this)">变更申请</button>';$(".save-btn").html(e)}returnTop(),null!=itemID&&(initdata(),showAuditBox())}),$(".Read_specification").on("click",function(){var e=$(this).parent().find(".norm-content").text();layer.open({type:1,area:["500px","300px"],title:"开发规范",shade:.2,closeBtn:0,shift:4,shadeClose:!0,content:'<div class="show-content">'+e+'<div class="option-checkbox-txt layui-form"><input type="checkbox" name="like1[write]" lay-skin="primary" title="已阅读" value="1" lay-filter="haveRead"></div></div>'}),form.render(),form.on("checkbox(haveRead)",function(e){readstatus=e.value,$(".notread span").text("已阅读"),layer.msg("已阅读!",{icon:1,time:600},function(){layer.getFrameIndex(window.name);layer.closeAll()})})});