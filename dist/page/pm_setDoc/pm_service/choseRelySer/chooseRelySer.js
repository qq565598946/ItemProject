"use strict";var layer=layui.layer,form=layui.form;function GetQueryString(e){var r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(r);return null!=a?unescape(a[2]):null}$(function(){getRelySer()});var flag=GetQueryString("flag");TokenCode=GetQueryString("TokenCode");var xhsdk=new Xhsdk(appID,appSecretKey);function getRelySer(){$(".loading-box1").show(),xhsdk.ajax({url:solution+"/microservice/getServerList",type:"POST",contentType:"application/json",dataType:"json",data:'{"accessToken":"'+accessToken+'"}',success:function(e){if(200==e.code){$(".loading-box1").hide(),$(".allRelySerItem").html("");for(var r=e.data.resulList,a=0;a<r.length;a++)r[a].isCheck?($(".allRelySerItem").append("<li><input type='checkbox' name='labelItem' lay-skin='primary' title='"+r[a].serverName+"' value='"+r[a].serverinfoID+"' lay-filter='relySerItem' checked='true'></li>"),$(".currLabel").append('<li><a href="javscript:#;" id="'+r[a].serverinfoID+'">'+r[a].serverName+'</a><i class="layui-icon" onclick="removeLabel(this)">&#x1006;</i></li>')):$(".allRelySerItem").append("<li><input type='checkbox' name='labelItem' lay-skin='primary' title='"+r[a].serverName+"' value='"+r[a].serverinfoID+"' lay-filter='relySerItem'></li>");form.render("checkbox","all_relyService")}else parent.parent.errorCode(e.code),$(".loading-box1").hide()},error:function(e){$(".loading-box1").hide(),layer.msg("数据请求错误!")}})}function removeLabel(e){var r=$(e).siblings("a").attr("id");$(".allRelySerItem li input[value = "+r+"]").attr("checked",!1),form.render("checkbox","all_relyService_box"),$(e).parents("li").remove()}function cancel(){var e=parent.layer.getFrameIndex(window.name);parent.layer.close(e)}xhsdk.setGetaWayUrl(GetaWay_url),xhsdk.setToken(TokenCode),xhsdk.setReqType("app"),xhsdk.setUserInfo(null),form.on("checkbox(relySerItem)",function(e){e.elem.checked?$(".currLabel").append('<li><a href="javscript:#;" id="'+e.value+'">'+$(this).attr("title")+'</a><i class="layui-icon" onclick="removeLabel(this)">&#x1006;</i></li>'):$(".currLabel li a[id = "+e.value+"]").parent("li").remove()}),form.on("submit(saveLabel)",function(e){if(0!=$(".currLabel").find("li").length){parent.relySerArr=[],parent.$(".alreadyRelySer").find("li").remove();for(var r=$(".currLabel").find("li").length,a=0;a<r;a++){var l=$(".currLabel").find("li:eq("+a+")").children("a").attr("id"),i=$(".currLabel").find("li:eq("+a+")").children("a").text();2==flag?(parent.relySerArr.push({curr_id:l,text:i}),parent.$(".business ul").append("<li data-curr_id = "+l+">"+i+'<i class="del-btn-con iconfont icon-icon" onclick="delservice(this)"></i></li>')):(parent.relySerArr.push({curr_id:l,text:i}),parent.$(".technical ul").append("<li data-curr_id = "+l+">"+i+'<i class="del-btn-con iconfont icon-icon" onclick="delservice(this)"></i></li>'))}var n=parent.layer.getFrameIndex(window.name);return parent.layer.close(n),!1}layer.msg("请选择依赖的服务！")});