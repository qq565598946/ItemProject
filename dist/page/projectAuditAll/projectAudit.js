"use strict";var laypage=layui.laypage,pageButton=null,Commonurl=null,project={},typedata=null;function GetQueryString(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null}TokenCode=sessionStorage.getItem("access_token");var loadingtip=$(".loading-box"),xhsdk=new Xhsdk(appID,appSecretKey);function init(e,o,c){if(1==c)pageButton="page-button",(project={}).query={projectName_LIKE:""},project.accessToken=accessToken,project.page={current:e,size:o},Commonurl=solution+"/projectinfo/list";else switch(project={},pageButton="page-button2",Commonurl=solution+"/xhWorkOrder/list",project.query={},project.accessToken=accessToken,project.page={current:e,size:o},typedata){case 1:(project={query:{auditStatus:"1"}}).accessToken=accessToken,project.page={current:e,size:o};break;case 2:(project={query:{auditStatus:"2"}}).accessToken=accessToken,project.page={current:e,size:o};break;case 3:(project={query:{auditStatus:"3"}}).accessToken=accessToken,project.page={current:e,size:o};break;case 4:(project={query:{}}).accessToken=accessToken,project.page={current:e,size:o};break;default:(project={query:{}}).accessToken=accessToken,project.page={current:e,size:o}}loadingtip.show(),xhsdk.ajax({type:"post",url:Commonurl,contentType:"application/json",dataType:"json",data:JSON.stringify(project),success:function(e){if(403!=e.errorCode)if(200==e.code){var t=e.data.records,a=e.data.total,s=e.data.current;1==c?renderData(t):auditData(t),laypage.render({elem:pageButton,count:Math.ceil(a),limit:o,groups:a,layout:["count","prev","page","next","skip"],curr:s,jump:function(e,t){if(!t){if(1==c)Commonurl=solution+"/projectinfo/list",project={accessToken:accessToken,page:{current:e.curr,size:o}};else switch(Commonurl=solution+"/xhWorkOrder/list",typedata){case 1:project.query={auditStatus:"1"},project.accessToken=accessToken,project.page={current:e.curr,size:o};break;case 2:project.query={auditStatus:"2"},project.accessToken=accessToken,project.page={current:e.curr,size:o};break;case 3:project.query={auditStatus:"3"},project.accessToken=accessToken,project.page={current:e.curr,size:o};break;default:project.query={},project.accessToken=accessToken,project.page={current:e.curr,size:o}}loadingtip.show(),xhsdk.ajax({type:"post",url:Commonurl,contentType:"application/json",dataType:"json",data:JSON.stringify(project),success:function(e){if(200==e.code){loadingtip.hide();var t=e.data.records;1==c?renderData(t):auditData(t)}else layer.msg("请求出现错误!!"),loadingtip.hide()},error:function(e){loadingtip.hide(),layer.msg("请求出现错误!!")}})}}})}else layer.msg("请求出现错误!!"),loadingtip.hide();else layer.msg(e.msg)},complete:function(){$(".loading-box").hide()},error:function(e){loadingtip.hide(),layer.msg("请求出现错误!!")}})}function renderData(e){if($(".itemCon").empty(),null==e)return layer.msg("暂无数据"),!1;for(var t=0;t<e.length;t++){var a=e[t].auditStatus,s="",o="";switch(0==a||3==a?o='<a onclick="editproject(this)" data-id="'+e[t].id+'" data-status="'+e[t].auditStatus+'" data-name="'+e[t].projectName+'"><i class="iconfont icon-bianji"></i></a><a href="#" data-id="'+e[t].id+'" data-status="'+e[t].auditStatus+'" onclick="Itemdetails(this)" class="destail-button"><i class="iconfont icon-chakan"></i></a>':2!=a&&1!=a||(o='<a href="#" data-id="'+e[t].id+'" data-status="'+e[t].auditStatus+'" onclick="Itemdetails(this)" class="destail-button"><i class="iconfont icon-chakan"></i></a>'),a){case 0:s="草稿";break;case 1:s='<span style="color: #cc940b;">审核中</span>';break;case 2:s='<span style="color:#15ca15">通过</span>';break;case 3:s='<span style="color:#CCCCCC">驳回</span>';break;case 4:s="下线";break;case 5:s="删除";break;default:s="-"}var c="<tr><td>"+e[t].projectCode+"</td><td>"+e[t].projectName+"</td><td>1.0</td><td>"+e[t].buildUnitName+"</td><td>"+e[t].buildUnitLeaderName+'</td><td  class="status-btn" data-status="'+e[t].auditStatus+'" onclick="search_result(this)"><i></i><span>'+s+'</span></td><td><div class="show-box">'+o+"</div></td></tr>";$(c).appendTo(".itemCon")}}function auditData(e){$(".project-implem").empty(),$(".itemCon").empty();for(var t=0;t<e.length;t++){var a=e[t].auditStatus,s="",o="";switch(s=1==e[t].type?"项目立项":"项目实施方案",e[t].auditStage){case"0":"无";break;case"1":"建设单位科技管理责任人";break;case"2":"建设单位科技管理负责人";break;case"5":"科信委立项审核";break;case"3":"平台审核组";break;case"4":"市局科信委";break;default:"-"}switch(a){case"0":o="草稿";break;case"1":o='<span style="color: #ccb75f;">待审核</span>';break;case"2":o='<span style="color:#2dca33">已审核</span>';break;case"3":o='<span style="color:#CCCCCC">驳回</span>';break;case"4":o='<span style="color:#b5b5b5">下线</span>';break;case"5":o="删除";break;default:o="-"}var c="<tr><td>"+(t+1)+" </td><td>"+s+" </td><td>"+e[t].projectName+"</td><td>"+e[t].projectCode+"</td><td>"+e[t].version+"</td><td><i></i><span>"+o+"</span></td><td>"+e[t].applyName+"</td><td>"+e[t].auditName+"</td><td>"+e[t].applyTime+'</td><td data-solutionid="'+e[t].solutionId+'" data-status="'+e[t].auditStatus+'"   data-id="'+e[t].projectId+'" data-auditstatus="'+e[t].auditStage+'" data-applyBy="'+e[t].applyBy+'"  data-type="'+e[t].type+'"  data-applyname="'+e[t].applyName+'" onclick="itemaudit(this)" class="destail-button">详情</td></tr>';$(c).appendTo(".project-implem")}}function itemaudit(o){var e=$(o).data("type"),t=$(o).data("id"),a=$(o).data("solutionid"),s=$(o).data("status"),c=$(o).data("auditstatus"),r=$(o).data("applyname");1==e?layer.open({type:2,title:"项目立项审核",shadeClose:!0,area:["100%","100%"],content:"../projectProgramme_Audit/projectProgramme_Audit.html?deatailId="+t+"&status="+s+"&TokenCode="+TokenCode,success:function(e,t){layer.getChildFrame("body",t).find("#applyName").val(r)}}):layer.open({type:2,title:"项目实施审核",shadeClose:!0,area:["100%","100%"],content:"../projectAudit_destail/projectAudit_destail.html?moduleid="+a+"&status="+s+"&projectID="+t+"&TokenCode="+TokenCode+"&solutionstage="+c,success:function(e,t){var a=layer.getChildFrame("body",t),s=$(o).data("applyBy");a.find(".applyBy").val(s)}})}function Itemdetails(e){var t=$(e).data("id"),a=$(e).data("status");projectName=$(e).parent().find("td").eq(3).text(),layer.open({type:2,title:"项目详情",shadeClose:!0,area:["100%","100%"],content:"../../page/projectProgramme/projectProgramme.html?deatailId="+t+"&status="+a+"&TokenCode="+TokenCode,success:function(e,t){layer.getChildFrame("body",t)}})}function editproject(e){var t=$(e).data("id"),a=$(e).data("status");projectName=$(e).data("name"),layer.open({type:2,title:"修改项目",shadeClose:!0,area:["100%","100%"],content:"../../page/projectApply/projectApply.html?deatailId="+t+"&tag=2&status="+a+"&TokenCode="+TokenCode})}function search_result(e){var t=$(e).data("status");layer.open({type:2,title:"项目进度",shadeClose:!0,area:["100%","100%"],content:"./page/pLogisticsTracking/pLogisticsTracking.html?status="+t+"&TokenCode="+TokenCode})}function add0(e){return e<10?"0"+e:e}function formatTime(e){var t=new Date(e),a=t.getFullYear(),s=t.getMonth()+1,o=t.getDate(),c=t.getHours(),r=t.getMinutes(),n=t.getSeconds();return a+"-"+add0(s)+"-"+add0(o)+" "+add0(c)+":"+add0(r)+":"+add0(n)}xhsdk.setGetaWayUrl(GetaWay_url),xhsdk.setToken(TokenCode),xhsdk.setReqType("app"),xhsdk.setUserInfo(null),$("#audit_btn button").click(function(){var e=$(this).index();switch($("#audit_btn button ").eq(e).addClass("active").siblings().removeClass("active"),typedata=null,e){case 0:init(typedata=1,10,2);break;case 1:init(1,10,typedata=2);break;case 2:typedata=3,init(1,10,2);break;case 3:typedata=4,init(1,10,2)}}),$(".ProgrammeList").on("click","li",function(){var e=$(this).index();$(this).addClass("layui-this").siblings().removeClass("layui-this"),$(".layui-col-md10 .table-box ").eq(e).css("display","block").siblings().css("display","none"),0==e?(project={},init(1,10,1)):(project={},init(typedata=1,10,2))}),$(function(){init(1,10,1)}),$("#add-item").click(function(){layer.open({anim:5,maxmin:!0,type:2,skin:"layui-layer-molv",title:"添加项目",shadeClose:!0,area:["100%","100%"],content:"./page/projectApply/projectApply.html?tag=1&TokenCode="+TokenCode})});